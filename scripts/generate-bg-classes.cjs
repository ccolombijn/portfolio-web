const fs = require('fs');
const path = require('path');

const imageDir = path.resolve(__dirname, '../resources/images');
const outputFile = path.resolve(__dirname, '../resources/scss/generated/_backgrounds.scss');
const imageExtensions = ['.png', '.jpg', '.jpeg', '.gif'];

fs.mkdirSync(path.dirname(outputFile), { recursive: true });

let scssContent = `// This file is auto-generated by scripts/generate-bg-classes.js
// Do not edit it manually.

`;

fs.readdirSync(imageDir).forEach(file => {
    const ext = path.extname(file).toLowerCase();
    if (imageExtensions.includes(ext)) {
        const filename = path.basename(file, ext);
        const className = `.bg-${filename}`;
        const imagePath = `../../images/${file}`; // Relative path from scss/generated to resources/images
        const webpPath = `../../images/${filename}.webp`;

        scssContent += `
${className} {
    // Fallback for browsers without WebP support
    background-image: url('${imagePath}');
}

html.webp ${className} {
    // WebP version for supported browsers
    background-image: url('${webpPath}');
}
`;
    }
});

fs.writeFileSync(outputFile, scssContent);
console.log('âœ… Background utility classes generated successfully.');